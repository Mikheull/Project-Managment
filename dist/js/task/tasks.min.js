$(document).on("click",".new-task",function(e){let ref=this.dataset.pro,tab=this.dataset.tab;bootbox.dialog({backdrop:!0,closeButton:!1,title:"Créer une tâche",buttons:{confirm:{label:"Ok",className:"btn primary-btn",callback:function(){let task_name=$('input[name="task_name"]').val(),deadline=$('input[name="deadline"]').val(),duration=$('input[name="duration"]').val();$.ajax({url:rootUrl+"controller/ajax/project/task/create_task.php",type:"POST",data:{task_name:task_name,deadline:deadline,duration:duration,project_token:ref,tab_token:tab},success:function(data){$("#tab_output").html(data)}})}},cancel:{label:"Annuler",className:"btn dark-btn"}},message:'<form method="POST" class="mr-bot-lg"><div class="container"><div class="row"><div class="col-12 input"><div class="input-field"> <label for="task_name" class="color-dark">Titre de la tâche</label> <input type="text" placeholder="Tache x" name="task_name" id="task_name"></div></div><div class="col-12 input mr-bot"><div class="input-field"> <label for="deadline" class="color-dark">Deadline</label> <input type="date" name="deadline" id="deadline"></div></div><div class="col-12 input mr-bot"><div class="input-field"> <label for="duration" class="color-dark">Durée</label> <input type="time" name="duration" id="duration" value="01:00"></div></div></div></div></form>'})}),$(document).on("click","[data-action='delete_task']",function(e){event.preventDefault();var ctx=document.getElementById("task-if"),ref=ctx.getAttribute("data-ref"),project=ctx.getAttribute("data-pro");bootbox.confirm({backdrop:!0,closeButton:!1,title:"Êtes vous sûr ?",message:"Vous êtes sur le point de supprimer la tâche définitivement.",buttons:{cancel:{label:'<i class="fa fa-times"></i> Cancel',className:"btn dark-btn"},confirm:{label:'<i class="fa fa-check"></i> Confirm',className:"btn primary-btn"}},callback:function(result){1==result&&$.ajax({url:rootUrl+"controller/ajax/project/task/task_short-actions.php",type:"POST",data:{task_token:ref,project_token:project,action:"delete"},success:function(data){$("#tab_output").html(data)}})}})}),$(document).on("click","[data-action='close_task']",function(e){event.preventDefault();var ctx=document.getElementById("task-if"),ref=ctx.getAttribute("data-ref"),project=ctx.getAttribute("data-pro");bootbox.confirm({backdrop:!0,closeButton:!1,title:"Êtes vous sûr ?",message:"Vous êtes sur le point de clôre la tâche.",buttons:{cancel:{label:'<i class="fa fa-times"></i> Cancel',className:"btn dark-btn"},confirm:{label:'<i class="fa fa-check"></i> Confirm',className:"btn primary-btn"}},callback:function(result){1==result&&$.ajax({url:rootUrl+"controller/ajax/project/task/task_short-actions.php",type:"POST",data:{task_token:ref,project_token:project,action:"close"},success:function(data){$("#tab_output").html(data)}})}})}),$(document).on("click","[data-action='reopen_task']",function(e){event.preventDefault();var ctx=document.getElementById("task-if"),ref=ctx.getAttribute("data-ref"),project=ctx.getAttribute("data-pro");bootbox.confirm({backdrop:!0,closeButton:!1,title:"Êtes vous sûr ?",message:"Vous êtes sur le point de ré-ouvrir la tâche.",buttons:{cancel:{label:'<i class="fa fa-times"></i> Cancel',className:"btn dark-btn"},confirm:{label:'<i class="fa fa-check"></i> Confirm',className:"btn primary-btn"}},callback:function(result){1==result&&$.ajax({url:rootUrl+"controller/ajax/project/task/task_short-actions.php",type:"POST",data:{task_token:ref,project_token:project,action:"reopen"},success:function(data){$("#tab_output").html(data)}})}})}),$(document).on("click","#popup-task-btn",function(){let ref=this.dataset.ref,project=this.dataset.pro;console.log(ref,project),$("#popup-task-wrapper").toggleClass("hidden"),$.ajax({url:rootUrl+"controller/ajax/project/task/task_short-actions.php",type:"POST",data:{task_token:ref,project_token:project,action:"popup-task"},success:function(data){$("#popup-task-wrapper").html(data)}})}),$(document).ready(function(){$(document).on("click","#close-task-popup",function(e){$("#popup-task-wrapper").empty(),$("#popup-task-wrapper").toggleClass("hidden")})}),$(document).bind("keydown",function(e){if(27==e.which)return $("#popup-task-wrapper #task-if").length&&(e.preventDefault(),$("#popup-task-wrapper").empty(),$("#popup-task-wrapper").toggleClass("hidden")),!1}),$("#popup-task-wrapper").mouseup(function(e){var container=$(".task_popup");$(".task_popup").length&&(container.is(e.target)||0!==container.has(e.target).length||($("#popup-task-wrapper").empty(),$("#popup-task-wrapper").toggleClass("hidden")))}),$(document).on("click",".head_menu li",function(){$(".head_menu li").removeClass("active"),$(this).addClass("active");let page=this.dataset.page;$(".page_el").removeClass("hidden"),$(".page_el").toggleClass("hidden"),$(".page_el#"+page).toggleClass("hidden")}),$(document).ready(function(){var urlParams=new URLSearchParams(location.search);if(1==urlParams.has("task")){let taskToken=urlParams.get("task");$("[data-ref='"+taskToken+"']").addClass("selected_item-task"),setTimeout(function(){$("[data-ref='"+taskToken+"']").removeClass("selected_item-task")},3e3)}});var timer=new easytimer.Timer;$(document).on("click","[data-action='launch-timer']",function(e){let ref=this.dataset.ref,project=this.dataset.pro;$(".btn-play").hide(),$(this).next("[data-action='stop-timer']").toggleClass("hidden"),$(this).parent().next(".timer-content").toggleClass("hidden"),$.ajax({url:rootUrl+"controller/ajax/project/task/task_short-actions.php",type:"POST",data:{task_token:ref,project_token:project,action:"launch_timer"},success:function(data){$("#timer_output").html(data)}}),timer.stop(),timer.start(),timer.addEventListener("secondsUpdated",function(e){$(".timer-content").html(timer.getTimeValues().toString())})}),$(document).on("click","[data-action='stop-timer']",function(e){let ref=this.dataset.ref,project=this.dataset.pro,time=timer.getTimeValues().toString();$(".btn-play").show(),$(this).toggleClass("hidden"),$(this).parent().next(".timer-content").toggleClass("hidden"),$.ajax({url:rootUrl+"controller/ajax/project/task/task_short-actions.php",type:"POST",data:{task_token:ref,project_token:project,time:time,action:"stop_timer"},success:function(data){$("#timer_output").html(data)}}),timer.stop()});